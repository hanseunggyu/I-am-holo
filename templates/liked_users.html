{% extends "base.html" %}
{% block title %}ë‚´ê°€ ì¢‹ì•„ìš”í•œ ì‚¬ëŒë“¤{% endblock %}
{% block content %}

<style>
  body {
    background: linear-gradient(135deg, #f3e7f3, #d4e0f0);
    font-family: 'Segoe UI', 'Pretendard', sans-serif;
  }

  .panel.left {
    background-color: #e9d8fd;
    padding: 2rem;
    border-radius: 15px 0 0 15px;
    color: #4a148c;
    text-align: center;
  }

  .panel.right {
    background-color: #fffdfc;
    padding: 2.5rem 3rem;
    border-radius: 0 15px 15px 0;
    box-shadow: 0 0 10px rgba(0,0,0,0.05);
  }

  .card {
    background-color: #fff4fa;
    border: none;
    border-radius: 20px;
    padding: 1.25rem;
  }

  .card h5 {
    font-size: 1.3rem;
    margin-bottom: 1rem;
  }

  .card-text {
    font-size: 0.95rem;
    line-height: 1.7;
  }

  .btn-outline-secondary {
    border-radius: 50px;
    font-weight: 500;
  }

  .text-muted {
    font-size: 1.05rem;
    color: #888 !important;
  }
</style>

<!-- ì™¼ìª½ íŒ¨ë„ -->
<div class="panel left">
  <h2>â¤ï¸ ì¢‹ì•„ìš”í•œ ì‚¬ëŒ</h2>
  <p>ë‚´ê°€ ê´€ì‹¬ ìˆëŠ” ì‚¬ëŒë“¤ì˜ ëª©ë¡ì…ë‹ˆë‹¤</p>
  <img src="https://emojicdn.elk.sh/ğŸ’œ?style=apple" alt="heart" style="width: 80px; margin-top: 30px;">
</div>

<!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
<div class="panel right">
  <h2 class="mb-4 text-center fw-bold">ğŸ’– ë‚´ê°€ ì¢‹ì•„ìš”í•œ ì‚¬ëŒ</h2>

  {% if liked %}
    {% set emoji_map = {
      'ì‚¬ì': 'ğŸ¦', 'ì›ìˆ­ì´': 'ğŸ’', 'ê³µë£¡': 'ğŸ¦–', 'ì—¬ìš°': 'ğŸ¦Š', 'í† ë¼': 'ğŸ°',
      'ê°•ì•„ì§€': 'ğŸ¶', 'ê³ ì–‘ì´': 'ğŸ±', 'ë‹¤ëŒì¥': 'ğŸ¿ï¸', 'ì‚¬ìŠ´': 'ğŸ¦Œ'
    } %}
    <div class="d-flex flex-column gap-4">
      {% for p in liked %}
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title"><strong>{{ p[0] }}</strong></h5>
            <p class="card-text">
              <strong>ì„±ë³„:</strong> {{ p[4] }}<br>
              <strong>ë‚˜ì´:</strong> {{ p[2] }}ì‚´<br>
              <strong>MBTI:</strong> {{ p[1] }}<br>
              <strong>ì‚¬ëŠ” ê³³:</strong> {{ p[3] }}<br>
              <strong>ì§ì—…:</strong> {{ p[5] }}<br>
              <strong>ì¢…êµ:</strong> {{ p[6] }}<br>
              <strong>ê¿ˆ:</strong> {{ p[7] }}<br>
              <strong>ì—°ì• ê´€:</strong> {{ p[8] }}<br>
              <strong>ë™ë¬¼:</strong> {{ emoji_map.get(p[10], '') }} {{ p[10] }}
            </p>
            <div class="text-end mt-2">
              <button class="btn btn-outline-danger btn-sm" onclick="unlikeUser('{{ p[9] }}', this)">ğŸ’” ì¢‹ì•„ìš” ì·¨ì†Œ</button>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center text-muted mt-5">
      <p>ğŸ˜¢ ì•„ì§ ì¢‹ì•„ìš”í•œ ì‚¬ëŒì´ ì—†ì–´ìš”<br>ë§ˆìŒì— ë“œëŠ” ì‚¬ëŒì—ê²Œ í•˜íŠ¸ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>
    </div>
  {% endif %}

  <div class="text-center mt-4">
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary rounded-pill px-4">â† ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
  </div>
</div>

<!-- âœ… ì¢‹ì•„ìš” ì·¨ì†Œ Ajax ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  function showToast(message) {
    const toastHTML = `
      <div class="toast align-items-center text-bg-success border-0 show"
           role="alert" aria-live="assertive" aria-atomic="true" style="position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1050;">
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto"
                  data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
      </div>`;
    const wrapper = document.createElement('div');
    wrapper.innerHTML = toastHTML;
    document.body.appendChild(wrapper);
    const toast = new bootstrap.Toast(wrapper.querySelector('.toast'), { delay: 2000 });
    toast.show();
    setTimeout(() => wrapper.remove(), 2500);
  }

  function unlikeUser(to_email, btn) {
    fetch(`/unlike/${to_email}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
    })
      .then(res => {
        if (!res.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜");
        return res.json();
      })
      .then(data => {
        showToast(data.message || "ğŸ’” ì¢‹ì•„ìš” ì·¨ì†Œë¨");
        const card = btn.closest('.card');
        if (card) card.remove();
      })
      .catch(error => {
        console.error("âŒ ì—ëŸ¬:", error);
        alert("ì¢‹ì•„ìš” ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      });
  }
</script>

{% endblock %}
